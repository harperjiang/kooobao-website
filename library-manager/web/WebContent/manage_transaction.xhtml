<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	template="/template/page_template.xhtml">
	<ui:param name="displayLogin" value="true"></ui:param>
	<ui:define name="title">酷宝图书馆-管理借阅记录</ui:define>
	<ui:define name="body">
		<h:form>
			<div class="page_title">管理/审核借阅记录</div>
			<div class="form" style="width: 560px; overflow: auto; padding: 5px;">
				<label>订单编号</label>
				<h:inputText value="#{manageTransactionBean.tranId}">
					<f:convertNumber integerOnly="true" />
				</h:inputText>
				<br /> <label>记录状态</label>
				<h:selectOneMenu value="#{manageTransactionBean.state}">
					<f:selectItems value="#{suppDataBean.transactionStates}" />
				</h:selectOneMenu>
				<br /> <label>借阅者id</label>
				<h:inputText value="#{manageTransactionBean.visitorId}" />
				<br /> <label>开始日期</label>
				<h:inputText value="#{manageTransactionBean.fromDate}"
					required="true">
					<f:convertDateTime pattern="#{envSettingBean.datePattern}"
						timeZone="#{envSettingBean.timeZone}" />
				</h:inputText>
				<br /> <label>结束日期</label>
				<h:inputText value="#{manageTransactionBean.toDate}" required="true">
					<f:convertDateTime pattern="#{envSettingBean.datePattern}"
						timeZone="#{envSettingBean.timeZone}" />
				</h:inputText>
				<br />
				<div style="width: 500px; float: left; text-align: center;">
					<h:commandLink action="#{manageTransactionBean.search}" value="搜索"
						styleClass="btn_solid" />
				</div>
			</div>
			<div style="margin-top: 10px;">
				<div class="table_header">
					<div class="table_header_col" style="width: 70px">订单号码</div>
					<div class="table_header_col">订书人</div>
					<div class="table_header_col" style="width: 200px">书名</div>
					<div class="table_header_col" style="width: 100px">创建日期</div>
					<div class="table_header_col" style="width: 100px">过期日期</div>
					<div class="table_header_col" style="width: 120px">当前状态</div>
					<div class="table_header_col" style="width: 200px">操作</div>
				</div>
				<ui:repeat var="tran" value="#{manageTransactionBean.trans}">
					<div class="table_row">
						<div class="table_cell" style="width: 70px">
							<h:outputLink value="/manage_view_transaction.html">
								<h:outputText value="#{tran.oid}" />
								<f:param name="tran_id" value="#{tran.oid}" />
							</h:outputLink>
						</div>
						<div class="table_cell">
							<h:outputText value="#{tran.visitor.id}" />
							<br />
							<h:outputText value="(积分余额#{tran.visitor.deposit})" />
						</div>
						<div class="table_cell" style="width: 200px">
							<h:outputText value="#{tran.book.name}" />
							<br />
							<h:outputText value="(积分#{tran.book.listPrice})" />
						</div>
						<div class="table_cell" style="width: 100px">
							<h:outputText value="#{tran.createTime}">
								<f:convertDateTime pattern="#{envSettingBean.datePattern}"
									timeZone="#{envSettingBean.timeZone}" />
							</h:outputText>
						</div>
						<div class="table_cell" style="width: 100px">
							<h:outputText value="#{tran.dueTime}">
								<f:convertDateTime pattern="#{envSettingBean.datePattern}"
									timeZone="#{envSettingBean.timeZone}" />
							</h:outputText>
						</div>
						<div class="table_cell" style="width: 120px">
							<h:outputText value="#{tran.stateText}" />
						</div>
						<div class="table_cell" style="width: 200px">
							<h:panelGroup rendered="#{tran.state == 'BORROW_REQUESTED'}">
								<h:commandLink value="审核通过" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.approve}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
								<h:commandLink value="手动检查库存" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.reserveStock}"
									rendered="#{!tran.stockReserved}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
							</h:panelGroup>
							<h:panelGroup rendered="#{tran.state == 'BORROW_APPROVED'}">
								<h:commandLink value="登记发货" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.send}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
							</h:panelGroup>
							<h:panelGroup rendered="#{tran.state == 'BORROW_SENT'}">
								<h:commandLink value="登记已收到" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.receiveBorrow}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
							</h:panelGroup>
							<h:panelGroup rendered="#{tran.state == 'RETURN_WAIT'}">
								<h:commandLink value="登记还书在途" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.recordReturn}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
							</h:panelGroup>
							<h:panelGroup
								rendered="#{tran.state == 'RETURN_WAIT' or tran.state == 'RETURN_SENT'}">
								<h:commandLink value="登记超时" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.recordExpire}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
							</h:panelGroup>
							<h:panelGroup rendered="#{tran.state == 'RETURN_SENT'}">
								<h:commandLink value="登记还书收讫" styleClass="btn_confirm_small"
									action="#{manageTransactionBean.receiveReturn}">
									<f:param name="tran_id" value="#{tran.oid}" />
								</h:commandLink>
							</h:panelGroup>
							<h:commandLink value="中断" styleClass="btn_solid_small"
								action="#{manageTransactionBean.interrupt}">
								<f:param name="tran_id" value="#{tran.oid}" />
							</h:commandLink>
							<h:commandLink value="添加注释" styleClass="btn_solid_small"
								action="#{manageTransactionBean.addComment}">
								<f:param name="tran_id" value="#{tran.oid}" />
							</h:commandLink>
						</div>
					</div>
				</ui:repeat>
				<div class="navigation_bar_right">
					<h:commandLink styleClass="btn_solid_small" style="float:left;"
						action="#{manageTransactionBean.prevPage}">上一页</h:commandLink>
					<h:outputText
						style="display:block;float:left;padding-top:6px;margin-right:5px;"
						value="第#{manageTransactionBean.currentPage}页，共#{manageTransactionBean.pageCount}页" />
					<h:commandLink styleClass="btn_solid_small" style="float:left;"
						action="#{manageTransactionBean.nextPage}">下一页</h:commandLink>
				</div>
			</div>
			<div class="clearer" />
			<div style="margin-top: 20px;">
				<label>快递单号</label>
				<h:inputText value="#{manageTransactionBean.expressNo}" />
				<label>操作说明:</label>
				<h:inputText value="#{manageTransactionBean.comment}" />
				<label>给借阅者的说明</label>
				<h:inputTextarea value="#{manageTransactionBean.tranComment}" />
			</div>
		</h:form>
	</ui:define>
</ui:composition>